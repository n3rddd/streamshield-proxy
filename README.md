# StreamShield Proxy:  HLS MPDæµåª’ä½“æ’­æ”¾å¤šæºä»£ç†èšåˆå·¥å…·

## ç®€ä»‹

StreamShield Proxy æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤šæºæµåª’ä½“èšåˆä»£ç†å·¥å…·ï¼Œæ—¨åœ¨è§£å†³å›  IP é™åˆ¶è€Œæ— æ³•ç›´æ¥æ’­æ”¾å„ç§æµåª’ä½“å†…å®¹çš„é—®é¢˜ã€‚å®ƒæ”¯æŒå¤šä¸ªVPSéƒ¨ç½²ï¼Œå½¢æˆCDNç½‘ç»œï¼Œä¸ºç”¨æˆ·æä¾›æµç•…çš„æµåª’ä½“æ’­æ”¾ä½“éªŒã€‚

## æ ¸å¿ƒåŠŸèƒ½

1.å¤šæºèšåˆï¼šæ”¯æŒå¯¼å…¥åœ¨çº¿urlï¼Œæœ¬åœ°æ–‡ä»¶å¯¼å…¥å¤šä¸ªæµåª’ä½“æº

2.æ™ºèƒ½ä»£ç†ï¼šè‡ªåŠ¨å¤„ç†éœ€è¦ä»£ç†çš„å†…å®¹

3.å†…å®¹å®šåˆ¶ï¼šæ”¯æŒç§»é™¤tv-logoã€ä¿®æ”¹group-titleç­‰è‡ªå®šä¹‰æ“ä½œ

4.å®‰å…¨åŠ å›ºï¼šé›†æˆå®‰å…¨tokenæœºåˆ¶

5.çµæ´»é…ç½®ï¼šé€šè¿‡ç¯å¢ƒå˜é‡å®ç°çµæ´»é…ç½®

6.é«˜æ•ˆç¼“å­˜ï¼šä½¿ç”¨LRUç¼“å­˜ä¼˜åŒ–æ€§èƒ½

7.è·¨å¹³å°æ”¯æŒï¼šæ”¯æŒarm64å’Œamd64æ¶æ„

## å‘å±•ç°çŠ¶

1.å…¨æ–°çš„å¤šæºèšåˆæœºåˆ¶

2.ä¼˜åŒ–çš„ç¼“å­˜ç³»ç»Ÿï¼Œæé«˜å“åº”é€Ÿåº¦

3.å¢å¼ºçš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

4.æ”¯æŒå¯¹ç‰¹å®šæºçš„å†…å®¹è¿›è¡Œè‡ªå®šä¹‰ä¿®æ”¹

5.æ”¹è¿›çš„SSLè¯ä¹¦é”™è¯¯å¤„ç†

ğŸ’– **ç‰¹åˆ«é¸£è°¢ï¼š** è¡·å¿ƒæ„Ÿè°¢ AKTV çš„ä½œè€…ï¼ä»–ä»¬å‘å¸ƒçš„ç¨‹åºè®©å¤§å®¶èƒ½æ›´æ–¹ä¾¿åœ°æ”¶çœ‹æµ·å¤–ç”µè§†å°ã€‚æœ¬é¡¹ç›®å·²å°†aktv m3uè®¾ç½®ä¸ºé»˜è®¤åœ¨çº¿æºã€‚

## ç¯å¢ƒå˜é‡é…ç½®

æ‰€æœ‰thetv pixmançš„è§†é¢‘æºéƒ½èƒ½ä»¥æ–‡ä»¶å½¢å¼å†™åœ¨æ–‡ä»¶å†…æ–¹ä¾¿æŒä¹…åŒ–ä¿å­˜ã€‚å…ˆæˆåŠŸè¿è¡Œä¸€æ¬¡dockerï¼Œæœ¬åœ°æ–‡ä»¶å¤¹å°±ä¼šç”Ÿæˆæ‰€æœ‰é¢„å…ˆç”Ÿæˆçš„å­æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ã€‚

é€šè¿‡æŒä¹…åŒ– -v /your_local_path/:/app/config  æŒ‚è½½

/app/config/

* **proxy_hosts/**
    * `default.txt` - é»˜è®¤ä»£ç† hosts åˆ—è¡¨ (é»˜è®¤åˆ›å»ºï¼Œæ¯æ¬¡å‡çº§æˆ‘ä¼šè¦†ç›–)
    * `user_defined.txt` - ç”¨æˆ·è‡ªå®šä¹‰ä»£ç† hosts åˆ—è¡¨ (é¢„åˆ›å»ºï¼Œç”¨æˆ·ç¼–è¾‘ï¼Œå‡çº§ä¸ä¼šè¦†ç›–)

* **remote_m3u/**
    * **no_proxy/**
        * `default_sources.txt` - é»˜è®¤éä»£ç† M3U æºåˆ—è¡¨ (é»˜è®¤åˆ›å»ºï¼Œæ¯æ¬¡å‡çº§æˆ‘ä¼šè¦†ç›–)
        * `sources.txt` - ç”¨æˆ·è‡ªå®šä¹‰éä»£ç† M3U æºåˆ—è¡¨ (é¢„åˆ›å»ºï¼Œç”¨æˆ·ç¼–è¾‘ï¼Œå‡çº§ä¸ä¼šè¦†ç›–)
    * **proxy_needed/**
        * `sources.txt` - ç”¨æˆ·è‡ªå®šä¹‰ä»£ç† M3U æºåˆ—è¡¨ (é¢„åˆ›å»ºï¼Œç”¨æˆ·ç¼–è¾‘ï¼Œå‡çº§ä¸ä¼šè¦†ç›–)

* **local_m3u/**
    * **no_proxy/**
        * `user_m3u.m3u` - ç”¨æˆ·æœ¬åœ°éä»£ç† M3U æ–‡ä»¶ (ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ ï¼Œæ–‡ä»¶åéšä¾¿å–ï¼Œåç¼€æ”¯æŒm3uå’Œtxt)
    * **proxy_needed/**
        * `user_m3u.m3u` - ç”¨æˆ·æœ¬åœ°ä»£ç† M3U æ–‡ä»¶ (ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ ï¼Œæ–‡ä»¶åéšä¾¿å–ï¼Œåç¼€æ”¯æŒm3uå’Œtxt)

* **generated/**
    * `all.m3u` - èšåˆçš„ M3U æ–‡ä»¶ (ç¨‹åºè‡ªåŠ¨ç”Ÿæˆ)


## ç»ˆç«¯æ’­æ”¾å™¨

åœ¨ Android ç¯å¢ƒä¸‹ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ [https://github.com/FongMi/Release/tree/fongmi/apk/release](https://github.com/FongMi/Release/tree/fongmi/apk/release) æ”¯æŒ mpd åŠ å¯†è§£ç æ’­æ”¾ã€‚

iosä¸‹ç”¨aptvè®¢é˜…ç°å·²æ”¯æŒã€‚ä¸æ”¯æŒmpdåŠ å¯†é¢‘é“ã€‚åœ¨åŸå…ˆè®¢é˜…é“¾æ¥ååŠ ä¸Šall.m3uä¾¿å¯ã€‚

Telegram channel https://t.me/tvb_ys

# Docker Composeéƒ¨ç½²æŒ‡å—

ä¸€é”®éƒ¨ç½²åªæ”¯æŒåœ¨ç¾å›½åŠ æ‹¿å¤§vpséƒ¨ç½²æ­£å¸¸æ”¶çœ‹thetvï¼Œã€‚å¦‚æƒ³åˆ†åˆ«éƒ¨ç½²thetvå’Œæ’­æ”¾åœ¨ä¸åŒvpsä¸Š å¯ä»¥åœ¨ç¾å›½vpsä¸Šå®‰è£…thetv docker ç„¶åè‡ªè¡Œä¿®æ”¹envå’Œymlé‡Œçš„åœ°å€å’Œç«¯å£å·

## å‰ç½®æ¡ä»¶

- Docker å’Œ Docker Composeå®‰è£…å®Œæˆ

## å…‹éš†æœ¬ä»“åº“
```bash
git clone https://github.com/pppyyyccc/streamshield-proxy.git

cd streamshield-proxy
```

## é…ç½®

ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®æ‚¨çš„ä¸ªäººé…ç½®ï¼š
```bash
  nano .env
```
## ä¸»è¦é…ç½®é¡¹ï¼š

- VPS_HOST: è®¾ç½®ä¸ºæ‚¨çš„æœåŠ¡å™¨ IP æˆ–åŸŸå
- SECURITY_TOKEN: è®¾ç½®ä¸€ä¸ªå®‰å…¨çš„è®¿é—®ä»¤ç‰Œ
- MYTVSUPER_TOKEN: å¦‚æœä½¿ç”¨ MyTVSuperï¼Œå¡«å…¥æ‚¨çš„ä»¤ç‰Œ

ä¸»åŠ¨ä¿®æ”¹ç«¯å£å·ï¼Œæ ¹æ®éœ€è¦è°ƒæ•´å…¶ä»–é…ç½®é¡¹ã€‚

æ ¹æ®éœ€è¦è°ƒæ•´å…¶ä»–é…ç½®é¡¹ã€‚

## ä½¿ç”¨
å¯åŠ¨æœåŠ¡ åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œï¼š
```bash
  docker-compose up -d
 ```

è¿›å…¥/configæ·»åŠ ä¿®æ”¹é“¾æ¥å’Œæ–‡ä»¶m3u

```bash
docker-compose restart streamshield-proxy
 ```
## è®¿é—®
åœ¨okå½±è§†ç»ˆç«¯æ’­æ”¾å™¨å†…-è®¾ç½®-ç›´æ’­ å¡«å…¥ä»¥ä¸‹æ ¼å¼çš„ URL è®¿é—®æ‚¨çš„é¢‘é“åˆ—è¡¨ï¼š

  http://[æ‚¨çš„æœåŠ¡å™¨IPæˆ–åŸŸå]:[STREAMSHIELD_PORT]/[SECURITY_TOKEN]/all.m3u ï¼ˆall.m3uå¯çœç•¥ï¼Œå’Œè€ç‰ˆæœ¬ä¿æŒç»Ÿä¸€ï¼‰
  
## ä¾‹å¦‚ï¼š
  http://100.100.100.100:4994/your_security_token/all.m3u

## âš ï¸ **å¼ºçƒˆå»ºè®®ç”¨ NGINX HTTPS åå‘ä»£ç†ä¸€ä¸‹æ’­æ”¾åœ°å€å’Œaktvçš„åœ°å€ï¼Œè¦æ³¨æ„é˜²æ­¢è¢«ç™½å«–ã€‚åå‘ä»£ç†è®¾ç½®è¦æ³¨æ„å…³é—­HTTP2ï¼Œaktvç¨‹åºä¸æ”¯æŒHTTP2**


## è®¾ç½®å®šæ—¶æ›´æ–° mytvsuper_tivimate.m3u æ–‡ä»¶ï¼š ä¸ºè‡ªåŠ¨åŒ–è¿è¡Œï¼Œæ¯æ—¥æ—©æ™šæ‰§è¡Œæ›´æ–°ã€‚æˆ–éµå¾ª https://pixman.io/topics/17 æ‰‹åŠ¨è°ƒæ•´ã€‚
```bash
(crontab -l 2>/dev/null | grep -v "docker exec pixman sh -c 'flask mytvsuper_tivimate'"; echo "0 5,17 * * * docker exec pixman sh -c 'flask mytvsuper_tivimate'") | crontab -
  ```  
ç¡®ä¿æ‰€æœ‰éœ€è¦çš„ç«¯å£éƒ½å·²å¼€æ”¾ï¼ˆé»˜è®¤ä¸º 4994, 5000, 4124ï¼‰
æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®
å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨ Issues é¡µé¢æå‡ºã€‚


# Docker éƒ¨ç½²æŒ‡å—
1. **é¢„ç½®** Pixman Docker é•œåƒï¼š

   [https://pixman.io/topics/17](https://pixman.io/topics/17)

2. **åŠ è½½** StreamShield Docker é•œåƒï¼š

```bash
   docker pull ppyycc/streamshield-proxy:latest
```
è®¾ç½®å®šæ—¶æ›´æ–° mytvsuper_tivimate.m3u æ–‡ä»¶ï¼š
ä¸ºè‡ªåŠ¨åŒ–è¿è¡Œï¼Œæ¯æ—¥æ—©æ™šæ‰§è¡Œæ›´æ–°ã€‚æˆ–éµå¾ª https://pixman.io/topics/17 æ‰‹åŠ¨è°ƒæ•´ã€‚
(crontab -l 2&gt;/dev/null | grep -v "docker exec pixman sh -c 'flask mytvsuper_tivimate'"; echo "0 5,17 * * * docker exec pixman sh -c 'flask mytvsuper_tivimate'") | crontab -



## å¯åŠ¨ Docker å®¹å™¨
```bash
docker run -d -p 4994:4994 --name streamshield-proxy \
    -e CUSTOM_DOMAIN="http://100.100.100.100:5000" \
    -e VPS_HOST="http://200.200.200.200:4994" \
    --restart always \
    ppyycc/streamshield-proxy:latest 
```
## å®šåˆ¶ç¯å¢ƒå˜é‡

| å˜é‡ | æè¿° |
| --- | --- |
| CUSTOM_DOMAIN | å·²è¿è¡Œpixman dockerçš„URLï¼Œä¸éœ€é™„å¸¦ m3u åç¼€ï¼Œå·²åŒ…å« YSP å’Œ 4GTV ç­‰èšåˆã€‚ç¤ºä¾‹ï¼šhttp://1.1.1.1:5000 æˆ– https://bb.bb.bb |
| VPS_HOST | ä¸ªäººçš„ VPS HOSTï¼Œæ”¯æŒ HTTP/HTTPSï¼Œå¯ä»¥æ˜¯ IP åœ°å€æˆ–å®šåˆ¶åŸŸåã€‚ç¤ºä¾‹ï¼šhttp://2.2.2.2:4994 æˆ– https://cc.cc.cc |
| DEBUG="true" | æ˜¯å¦è¦å¼€å¯DEBUGï¼Œ ä¸å†™è¿™ä¸ªæ‰©å±•é»˜è®¤ä¸å¼€å¯ã€‚ |
| SECURITY_TOKEN="testtoken" | è¾“å…¥è‡ªå·±è®¾ç½®çš„å®‰å…¨tokené˜²æ­¢æ‰«åˆ°ç«¯å£è¢«çˆ†ç ´ã€‚ |
| EXTRA_M3U_URLS | å†™å…¥å¤šä¸ªåˆ«çš„VPSè®¢é˜…åœ°å€è¿›è¡Œå¤šæºèšåˆï¼Œå¤šæºä¼˜å…ˆçº§æŒ‰ç…§å†™å…¥å…ˆåæ’å®šä¼˜å…ˆçº§ï¼Œæœ¬æœºä¼˜å…ˆçº§åœ¨æœ€åã€‚ |




## éƒ¨ç½²æ¡ˆä¾‹


### ä»…ä½¿ç”¨ IP åŒä¸€VPSåœ°å€éƒ¨ç½²ï¼š
```bash
docker run --name thetv -d -p 41244:4124 dtankdemp/thetvapp-m3u:latest
docker pull ppyycc/streamshield-proxy:latest \
docker run -d -p 8888:4994 --name streamshield-proxy \
-e CUSTOM_DOMAIN="http://100.100.100.100:5000" \
-e VPS_HOST="http://100.100.100.100:8888" \
-e SECURITY_TOKEN="test11" \
--restart always \
ppyycc/streamshield-proxy:latest
```

è®¿é—®åœ°å€ï¼šhttp://100.100.100.100:8888/test11/all.m3uï¼Œ å¹¶å·²è‡ªåŠ¨å¯¼å…¥ mytvsuper_tivimate.m3uï¼Œå¹¶ä¸”èƒ½æ”¶çœ‹å¤§é™†ç”µè§†å°ã€‚


### å¤šVPS CDNéƒ¨ç½²ï¼š
æŠŠåˆ«çš„VPSç”Ÿæˆçš„è®¢é˜…é“¾æ¥æ”¾åœ¨ä¸»æœåŠ¡å™¨çš„config/remote_m3u/no_proxy/sources.txtä¸‹ä¾¿å¯ã€‚

è®¿é—®åœ°å€ï¼šhttps://iptv.bbbb.com/test33ï¼Œ æ²¡æœ‰å¤§é™†ç”µè§†å°ï¼Œ
æ•ˆæœå¦‚ä¸‹
![image](https://github.com/user-attachments/assets/a7862d7c-fec5-4d9e-9d7e-a67779ed4e7b)


## åª’ä½“ç»ˆç«¯é…ç½®

åœ¨ç›´æ’­é…ç½®ä¸­ï¼Œå¦‚ å½±è§†ï¼Œåªéœ€å¡«å…¥ https://iptv.bbbb.com/testtoken æˆ– http://200.200.200.200:8888/testtoken å³å¯å®ç°æµåª’ä½“æ’­æ”¾ã€‚


## ç¤¾åŒºäº’åŠ¨ä¸æ”¯æŒ

æ›´å¤šè¯¦æƒ…ã€é—®é¢˜è§£å†³æˆ–åŠ ç¾¤æ¢è®¨ï¼Œæ•¬è¯·åŠ å…¥ Pixman çš„ Telegram ç¾¤ç»„ï¼šhttps://t.me/livednowgroup


## é¡¹ç›®è´¡çŒ®

æ¬¢è¿ä»£ç æäº¤ã€æå‡ºåŠŸèƒ½éœ€æ±‚ä¸é”™è¯¯æ±‡æŠ¥ï¼æœ‰æ„å‘è´¡çŒ®è€…ï¼Œè¯·è®¿é—® é—®é¢˜é¡µé¢ï¼Œå‚ä¸å…±å»ºã€‚


## ä½¿ç”¨åè®®

æœ¬é¡¹ç›®éµå¾ª MIT å¼€æºåè®®ã€‚
```
